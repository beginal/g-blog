# 게시물 헤더 네비게이션 기능 명세서

## 📝 사용자 지시사항

> 현재 폴더에 이미지가 하나 있을거야 밑에 이미지 설명에 더 자세히 적을게

### 이미지 설명

> velog의 레이아웃인데 본문 바로 옆에 우리가 만드려고하는 목차 사이드바가 있지? 그거랑 비슷하게 만들어주면 돼

### 특별 요구사항

> - 기존 Toast UI Editor와 완벽 호환
> - 데스크톱 우선 구현 (XL 이상에서만 표시)
> - 부드러운 스크롤 애니메이션 구현
> - 현재 위치 하이라이트 필수

### 기능 우선순위

> - 🔥 필수: 기본 목차 추출 및 표시
> - 🔥 필수: 스크롤 추적 및 하이라이트
> - 🚀 중요: 부드러운 스크롤 네비게이션
> - ⭐ 선택: 읽기 진행률 표시
> - 💡 향후: 모바일 플로팅 버튼

### 참고 사이트/앱

> - GitHub README 목차 기능
> - Notion의 페이지 아웃라인
> - MDN 문서의 사이드바 목차

### 추가 지시사항

> - 기존 디자인 시스템(Tailwind) 최대한 활용
> - Toast UI Editor의 렌더링 타이밍 고려
> - 성능 최적화를 위한 IntersectionObserver 활용
> - 헤더 중복 시 ID 고유성 보장

---

## 📋 기능 개요

### 목적과 배경

- 긴 게시물을 읽을 때 콘텐츠 구조를 한눈에 파악하기 어려움
- 원하는 섹션으로 빠르게 이동할 수 있는 네비게이션이 필요
- 현재 읽고 있는 위치를 시각적으로 표시하여 독서 경험 향상

### 기대 효과

- 긴 글의 구조를 한눈에 파악 가능
- 원하는 섹션으로 즉시 이동 가능
- 현재 읽기 위치 추적으로 콘텐츠 소비 경험 개선
- 전문적인 기술 블로그의 UX 제공

## 🔧 상세 구현 계획

### 구현 단계

1. [x] TableOfContents 컴포넌트 기본 구조 설계
2. [x] 마크다운 콘텐츠에서 헤더 추출 로직 구현
3. [x] 스크롤 위치 추적 및 활성 헤더 표시
4. [x] 부드러운 스크롤 네비게이션 구현
5. [x] 반응형 디자인 (데스크톱 전용)
6. [ ] Toast UI Editor와의 통합 최적화
7. [ ] 테스트 및 디버깅

### 컴포넌트 구조

```
src/
├── components/
│   └── molecules/
│       └── post/
│           └── TableOfContents/
│               ├── index.ts
│               ├── TableOfContents.tsx
│               ├── TableOfContents.types.ts
│               └── extractHeaders.ts
└── app/
    └── (pages)/
        └── posts/
            └── [id]/
                └── page.tsx (수정)
```

### 데이터 흐름

1. 게시물 콘텐츠 로드 →
2. 마크다운에서 헤더 추출 →
3. DOM에 헤더 ID 부여 →
4. IntersectionObserver로 스크롤 위치 추적 →
5. 활성 헤더 하이라이트 업데이트

### 상태 관리

- `headers`: 추출된 헤더 목록 (TocItem[])
- `activeId`: 현재 활성화된 헤더 ID (string)
- 모두 로컬 상태로 관리 (전역 상태 불필요)

## 💻 기술적 고려사항

### 기술 스택

- React 패턴: 함수형 컴포넌트 + Hooks
- 상태 관리: useState (로컬 상태)
- 스타일링: Tailwind CSS + cn 유틸리티
- DOM 조작: IntersectionObserver API

### 성능 최적화

- 헤더 추출은 초기 1회만 실행
- IntersectionObserver로 효율적인 스크롤 추적
- 불필요한 리렌더링 방지를 위한 상태 최적화

### 접근성

- 시맨틱 HTML 사용 (nav, button 요소)
- 키보드 네비게이션 지원
- 포커스 관리 및 시각적 피드백

## ⚠️ 엣지 케이스 및 에러 처리

### 예상되는 엣지 케이스

1. 헤더가 없는 콘텐츠

   - 상황: 게시물에 헤더가 하나도 없음
   - 대응: TableOfContents 컴포넌트 렌더링하지 않음

2. Toast UI Editor의 렌더링 타이밍

   - 상황: DOM이 완전히 렌더링되기 전에 헤더 ID 부여 시도
   - 대응: setTimeout으로 지연 처리 (현재 100ms)

3. 동일한 헤더 텍스트

   - 상황: 여러 헤더가 같은 텍스트를 가짐
   - 대응: ID 생성 시 중복 처리 로직 추가 필요

4. 특수문자가 포함된 헤더
   - 상황: 헤더에 특수문자나 이모지 포함
   - 대응: ID 생성 시 정규식으로 제거

### 에러 처리 전략

- 헤더 추출 실패 시 빈 배열 반환
- DOM 요소 찾기 실패 시 무시하고 계속 진행
- Observer 등록 실패 시 콘솔 경고만 표시

## 🧪 테스트 계획

### 단위 테스트

- [ ] extractHeaders 함수 테스트
  - 다양한 마크다운 형식 처리
  - 한글/영문/특수문자 처리
  - 빈 콘텐츠 처리
- [ ] TableOfContents 컴포넌트 렌더링 테스트
- [ ] 클릭 이벤트 처리 테스트

### 통합 테스트

- [ ] Toast UI Editor와의 연동 테스트
- [ ] 스크롤 추적 정확도 테스트
- [ ] 다양한 길이의 콘텐츠 테스트

### 수동 테스트 체크리스트

- [x] 데스크톱 Chrome에서 정상 작동
- [ ] Safari, Firefox 호환성
- [x] 1280px 이상에서만 표시 확인
- [ ] 부드러운 스크롤 동작
- [ ] 활성 헤더 하이라이트 정확도

## 📝 구현 중 메모

### 발견된 이슈

1. Toast UI Editor가 헤더에 자동으로 ID를 부여하지 않음

   - 해결: DOM 렌더링 후 수동으로 ID 부여

2. 스크롤 위치 계산 시 헤더가 화면 상단에 가려짐
   - 해결: scrollTo 시 100px offset 추가

### 향후 개선사항

1. 헤더 레벨에 따른 시각적 계층 표현 강화
2. 모바일에서 플로팅 버튼으로 TOC 접근
3. 헤더 개수가 너무 많을 때 스크롤 가능한 컨테이너
4. 프로그레스 바 추가 (읽기 진행률 표시)
5. 헤더 중복 시 번호 자동 추가 로직
