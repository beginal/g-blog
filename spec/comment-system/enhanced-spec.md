# comment-system - Enhanced 기능정의서 (Claude 작성)

## 📝 기본 정보

- **원본 작성자**: 사용자
- **Enhanced by**: Claude
- **작성일**: 2025-07-05
- **예상 작업시간**: 10-14시간 (Claude 추정)

## 📋 사용자 요구사항 분석

> 사용자가 작성한 내용을 분석하고 핵심 요구사항을 정리

### 핵심 기능

- **댓글 작성**: 익명 사용자가 닉네임과 댓글 내용으로 댓글 작성
- **댓글 표시**: 기존 댓글을 시간순(오래된순)으로 나열
- **댓글 개수**: 총 댓글 수를 표시하여 참여도 시각화
- **반응형 UI**: 모바일과 데스크톱에서 일관된 사용자 경험

### 사용자 스토리

- **방문자는** 흥미로운 게시물을 읽은 후 **피드백을 남기기** 위해 **댓글을 작성할 수 있어야** 한다.
- **방문자는** 다른 사람들의 의견을 보기 위해 **기존 댓글들을 확인할 수 있어야** 한다.
- **방문자는** 게시물의 인기도를 파악하기 위해 **댓글 개수를 확인할 수 있어야** 한다.

## 🔧 기술적 구현 방안

> Claude가 제안하는 구체적인 구현 방법

### 컴포넌트 구조

```
src/
├── app/
│   ├── api/
│   │   └── comments/
│   │       ├── route.ts                # POST /api/comments (댓글 작성)
│   │       └── [postId]/
│   │           └── route.ts            # GET /api/comments/[postId] (댓글 조회)
│   └── (pages)/
│       └── posts/
│           └── [id]/
│               └── page.tsx            # 게시물 상세페이지 (CommentSection 추가)
├── components/
│   └── molecules/
│       └── comment/
│           ├── CommentSection.tsx      # 댓글 전체 섹션
│           ├── CommentForm.tsx         # 댓글 작성 폼
│           ├── CommentList.tsx         # 댓글 목록
│           ├── CommentItem.tsx         # 개별 댓글
│           ├── CommentEmpty.tsx        # 빈 상태 표시
│           └── index.ts                # Export 정리
├── hooks/
│   └── useComments.ts                  # 댓글 관련 로직
├── types/
│   └── comment.types.ts                # 댓글 타입 정의
├── utils/
│   └── validation.ts                   # 댓글 validation
└── lib/
    └── supabase.ts                     # Supabase 클라이언트 (기존 파일 활용)
```

### 데이터 모델 설계

```typescript
interface Comment {
  id: string;
  post_id: string;
  nickname: string;
  content: string;
  created_at: string;
  ip_hash?: string; // 스팸 방지용 (선택사항)
}

interface CommentFormData {
  nickname: string;
  content: string;
}
```

### 상태 관리 전략

- **Local State**: useState로 댓글 목록, 폼 데이터, 로딩 상태 관리
- **Form Handling**: controlled components로 실시간 validation
- **Optimistic Update**: 댓글 작성 시 즉시 UI 업데이트 후 서버 동기화

### API 설계

```typescript
// API 엔드포인트
GET    /api/comments/[postId]     # 댓글 목록 조회
POST   /api/comments              # 댓글 작성
GET    /api/comments/count/[postId] # 댓글 개수 조회 (선택사항)
```

## 🎨 UX/UI 개선 제안

> 사용자 요구사항을 바탕으로 한 UX/UI 개선 제안

### 사용자 플로우

1. **게시물 읽기** → 하단으로 스크롤
2. **댓글 섹션 확인** → 기존 댓글 읽기 또는 작성 폼으로 이동
3. **댓글 작성** → 닉네임 입력 → 내용 입력 → 제출
4. **즉시 반영** → 작성한 댓글이 목록에 추가됨
5. **폼 초기화** → 새로운 댓글 작성 준비

### 시각적 계층 구조

- **섹션 제목**: "댓글 N개" (크고 명확한 폰트)
- **작성 폼**: 시각적으로 구분된 카드 형태
- **댓글 목록**: 각 댓글이 개별 카드로 구분
- **구분선**: 게시물 본문과 댓글 섹션 사이 명확한 경계

### 접근성 고려사항

- **시맨틱 HTML**: section, form, article 태그 적절히 사용
- **키보드 네비게이션**: Tab으로 폼 요소 간 이동 가능
- **스크린 리더**: aria-label, aria-describedby 속성 추가
- **포커스 관리**: 댓글 작성 후 적절한 포커스 이동

## ⚠️ 잠재적 이슈 및 해결방안

> Claude가 예상하는 문제점과 해결책

### 기술적 위험요소

1. **이슈**: 댓글 작성 중 네트워크 오류 발생

   - **해결방안**: 재시도 로직 구현, 로컬 스토리지에 임시 저장
   - **우회방안**: 오류 메시지 표시 후 사용자가 재작성 가능

2. **이슈**: 동시에 여러 댓글 작성 시 순서 보장 문제

   - **해결방안**: 서버에서 timestamp 기준 정렬, 낙관적 업데이트 후 재정렬
   - **우회방안**: 페이지 새로고침으로 최신 상태 동기화

3. **이슈**: 스팸 댓글 대량 등록
   - **해결방안**: 클라이언트 사이드 rate limiting, IP 기반 제한
   - **우회방안**: 관리자 수동 삭제 기능 (향후 구현)

### 성능 고려사항

- **댓글 수가 많을 때**: 가상화 또는 페이지네이션 고려
- **실시간 업데이트**: WebSocket 대신 HTTP 폴링으로 단순화
- **이미지 최적화**: 아바타 없이 텍스트 기반으로 경량화

### UX 위험요소

1. **이슈**: 긴 댓글로 인한 레이아웃 깨짐
   - **해결방안**: CSS로 최대 높이 제한, "더보기" 기능
2. **이슈**: 모바일에서 키보드 올라올 때 UI 가려짐
   - **해결방안**: viewport 높이 조정, 스크롤 위치 자동 조정

## 🧪 테스트 계획

### 필수 테스트 시나리오

- [x] **기본 댓글 작성**: 정상적인 닉네임과 내용으로 댓글 작성
- [x] **댓글 목록 표시**: 작성된 댓글이 올바른 순서로 표시
- [x] **폼 validation**: 빈 값, 최소 글자 수 미달 시 오류 처리
- [x] **반응형 테스트**: 모바일, 태블릿, 데스크톱에서 UI 확인
- [x] **로딩 상태**: 댓글 작성 중 로딩 스피너 표시

### 엣지 케이스

- [x] **네트워크 오류**: 댓글 작성 실패 시 사용자 피드백
- [x] **빈 댓글 목록**: "첫 번째 댓글을 작성해보세요" 메시지 표시
- [x] **긴 닉네임/댓글**: 레이아웃 깨지지 않고 적절히 처리
- [x] **특수문자**: 이모지, 특수기호 포함 댓글 정상 처리
- [x] **중복 제출**: 빠른 연속 클릭 시 중복 방지

### 성능 테스트

- [x] **대량 댓글**: 100개 이상 댓글이 있을 때 렌더링 성능
- [x] **메모리 누수**: 페이지 장시간 머무를 때 메모리 사용량

## 📈 성공 지표

- **사용률**: 게시물 조회 대비 댓글 작성 비율 > 5%
- **완료율**: 댓글 작성 시작 대비 완료 비율 > 80%
- **성능**: 댓글 작성 후 화면 반영까지 < 1초
- **오류율**: 댓글 작성 실패 비율 < 2%

## 🔄 향후 확장 계획

1. **Phase 2**: 댓글 좋아요/싫어요 기능
2. **Phase 3**: 대댓글(답글) 시스템
3. **Phase 4**: 관리자 댓글 관리 기능
4. **Phase 5**: 사용자 인증 연동

---

**📌 Enhanced 완료! 확인 후 "개발 계획서 작성해줘"라고 말씀해주세요!**
